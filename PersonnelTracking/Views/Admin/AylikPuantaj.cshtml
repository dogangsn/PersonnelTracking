@using Kod_Yazilim_Personel.Models
@{
    ViewBag.Title = "AylikPuantaj";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<main>
    <style>
        /*table {
            max-width: 980px;
            table-layout: fixed;
            margin: auto;
        }

        th, td {
            padding: 5px 10px;
            border: 1px solid #000;
        }

        thead, tfoot {
            background: #f9f9f9;
            display: table;
            width: 100%;
            width: calc(100% - 18px);
        }

        tbody {
            height: 300px;
            overflow: auto;
            overflow-x: hidden;
            display: block;
            width: 100%;
        }

            tbody tr {
                /*display: table;
                width: 100%;*/
                table-layout: fixed;
            }*/
    </style>

    <div id="loader-wrapper" style="display:none;">
        <div id="loader"></div>
    </div>
    <div class="container-fluid text-center">
        <div class="card card-cascade narrower">
            <section>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 mr-0">
                        <div class="view gradient-card-header light-blue lighten-1">
                            <h2 class="h2-responsive mb-0">Aylık Puantaj Çizelgesi</h2>
                        </div>
                        <br />
                        <br />
                        <br />
                        <div class="row card-body pt-3">

                            <!--First column-->
                            <div class="col-md-4">
                                <div class="md-form">
                                    @*<input placeholder="" type="text" id="datepicker" class="form-control datepicker picker__input" readonly="" aria-haspopup="true" aria-expanded="false" aria-readonly="false" aria-owns="from_root"><div class="picker" id="from_root" aria-hidden="true"><div class="picker__holder" tabindex="-1"><div class="picker__frame"><div class="picker__wrap"><div class="picker__box"><div class="picker__header"><div class="picker__date-display"><div class="picker__weekday-display">Tuesday</div><div class="picker__month-display"><div>Jul</div></div><div class="picker__day-display"><div>03</div></div><div class="picker__year-display"><div>2018</div></div></div><select class="picker__select--year" aria-controls="from_table" title="Select a year" disabled="disabled"><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018" selected="">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option></select><select class="picker__select--month" aria-controls="from_table" title="Select a month" disabled="disabled"><option value="0">January</option><option value="1">February</option><option value="2">March</option><option value="3">April</option><option value="4">May</option><option value="5">June</option><option value="6" selected="">July</option><option value="7">August</option><option value="8">September</option><option value="9">October</option><option value="10">November</option><option value="11">December</option></select><div class="picker__nav--prev" data-nav="-1" role="button" aria-controls="from_table" title="Previous month"> </div><div class="picker__nav--next" data-nav="1" role="button" aria-controls="from_table" title="Next month"> </div></div><table class="picker__table" id="from_table" role="grid" aria-controls="from" aria-readonly="true"><thead><tr><th class="picker__weekday" scope="col" title="Sunday">Sun</th><th class="picker__weekday" scope="col" title="Monday">Mon</th><th class="picker__weekday" scope="col" title="Tuesday">Tue</th><th class="picker__weekday" scope="col" title="Wednesday">Wed</th><th class="picker__weekday" scope="col" title="Thursday">Thu</th><th class="picker__weekday" scope="col" title="Friday">Fri</th><th class="picker__weekday" scope="col" title="Saturday">Sat</th></tr></thead><tbody><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530392400000" role="gridcell" aria-label="1 July, 2018">1</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530478800000" role="gridcell" aria-label="2 July, 2018">2</div></td><td role="presentation"><div class="picker__day picker__day--infocus picker__day--today picker__day--highlighted" data-pick="1530565200000" role="gridcell" aria-label="3 July, 2018" aria-activedescendant="true">3</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530651600000" role="gridcell" aria-label="4 July, 2018">4</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530738000000" role="gridcell" aria-label="5 July, 2018">5</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530824400000" role="gridcell" aria-label="6 July, 2018">6</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530910800000" role="gridcell" aria-label="7 July, 2018">7</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1530997200000" role="gridcell" aria-label="8 July, 2018">8</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531083600000" role="gridcell" aria-label="9 July, 2018">9</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531170000000" role="gridcell" aria-label="10 July, 2018">10</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531256400000" role="gridcell" aria-label="11 July, 2018">11</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531342800000" role="gridcell" aria-label="12 July, 2018">12</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531429200000" role="gridcell" aria-label="13 July, 2018">13</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531515600000" role="gridcell" aria-label="14 July, 2018">14</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531602000000" role="gridcell" aria-label="15 July, 2018">15</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531688400000" role="gridcell" aria-label="16 July, 2018">16</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531774800000" role="gridcell" aria-label="17 July, 2018">17</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531861200000" role="gridcell" aria-label="18 July, 2018">18</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1531947600000" role="gridcell" aria-label="19 July, 2018">19</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532034000000" role="gridcell" aria-label="20 July, 2018">20</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532120400000" role="gridcell" aria-label="21 July, 2018">21</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532206800000" role="gridcell" aria-label="22 July, 2018">22</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532293200000" role="gridcell" aria-label="23 July, 2018">23</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532379600000" role="gridcell" aria-label="24 July, 2018">24</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532466000000" role="gridcell" aria-label="25 July, 2018">25</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532552400000" role="gridcell" aria-label="26 July, 2018">26</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532638800000" role="gridcell" aria-label="27 July, 2018">27</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532725200000" role="gridcell" aria-label="28 July, 2018">28</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532811600000" role="gridcell" aria-label="29 July, 2018">29</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532898000000" role="gridcell" aria-label="30 July, 2018">30</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1532984400000" role="gridcell" aria-label="31 July, 2018">31</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533070800000" role="gridcell" aria-label="1 August, 2018">1</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533157200000" role="gridcell" aria-label="2 August, 2018">2</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533243600000" role="gridcell" aria-label="3 August, 2018">3</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533330000000" role="gridcell" aria-label="4 August, 2018">4</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533416400000" role="gridcell" aria-label="5 August, 2018">5</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533502800000" role="gridcell" aria-label="6 August, 2018">6</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533589200000" role="gridcell" aria-label="7 August, 2018">7</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533675600000" role="gridcell" aria-label="8 August, 2018">8</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533762000000" role="gridcell" aria-label="9 August, 2018">9</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533848400000" role="gridcell" aria-label="10 August, 2018">10</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1533934800000" role="gridcell" aria-label="11 August, 2018">11</div></td></tr></tbody></table><div class="picker__footer"><button class="picker__button--today" type="button" data-pick="1530565200000" aria-controls="from" disabled="disabled">Today</button><button class="picker__button--clear" type="button" data-clear="1" aria-controls="from" disabled="disabled">Clear</button><button class="picker__button--close" type="button" data-close="true" aria-controls="from" disabled="disabled">Close</button></div></div></div></div></div></div>*@
                                    <label for="bday-month">Dönem Seçiniz</label>
                                    <input id="bday-month" type="month" name="bday-month" value="@DateTime.Now.ToString("yyyy-MM")">
                                    @*<label for="date-picker-example" class="active">Dönem Seçiniz</label>*@
                                </div>
                                <button class="btn btn-success" id="KayitGetir">Kayıtları Listele</button>
                            </div>
                            <div class="col-md-12">
                                <button class="btn btn-success float-right" onclick="tableToExcel('Kayitlar', 'W3C Example Table')"><i class="fa fa-file-excel-o" aria-hidden="true"></i>  Excel'e Aktar</button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div> <p id="Tarih">  - Ayın Kayıtları </p> </div>
                                        <div class="input-group md-form form-sm form-2 pl-0 mb-0">
                                            <input class="form-control my-0 py-1 grey-border" type="text" placeholder="Search" aria-label="Search" id="myInput" onkeyup="myFunction()">
                                            <div class="input-group-append">
                                                <span class="input-group-text waves-effect grey lighten-3" id="basic-addon1">
                                                    <a><i class="fa fa-search text-grey" aria-hidden="true"></i></a>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div> <br />
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped" id="Kayitlar">
                                        <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">Personel Adı Soyadı</th>
                                                <th scope="col">1.Gün</th>
                                                <th scope="col">2.Gün</th>
                                                <th scope="col">3.Gün</th>
                                                <th scope="col">4.Gün</th>
                                                <th scope="col">5.Gün</th>
                                                <th scope="col">6.Gün</th>
                                                <th scope="col">7.Gün</th>
                                                <th scope="col">8.Gün</th>
                                                <th scope="col">9.Gün</th>
                                                <th scope="col">10.Gün</th>
                                                <th scope="col">11.Gün</th>
                                                <th scope="col">12.Gün</th>
                                                <th scope="col">13.Gün</th>
                                                <th scope="col">14.Gün</th>
                                                <th scope="col">15.Gün</th>
                                                <th scope="col">16.Gün</th>
                                                <th scope="col">17.Gün</th>
                                                <th scope="col">18.Gün</th>
                                                <th scope="col">19.Gün</th>
                                                <th scope="col">20.Gün</th>
                                                <th scope="col">21.Gün</th>
                                                <th scope="col">20.Gün</th>
                                                <th scope="col">22.Gün</th>
                                                <th scope="col">23.Gün</th>
                                                <th scope="col">24.Gün</th>
                                                <th scope="col">25.Gün</th>
                                                <th scope="col">26.Gün</th>
                                                <th scope="col">27.Gün</th>
                                                <th scope="col">28.Gün</th>
                                                <th scope="col">29.Gün</th>
                                                <th scope="col">30.Gün</th>
                                                <th scope="col">31.Gün</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <th scope="row">1</th>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <br />


    <script>
        $(document).ready(function () {
            $('.datepicker').pickadate({});
        });

        $('#KayitGetir').click(function () {
            $("#loader-wrapper").show();
            var donem = $('#bday-month').val();

            console.log(donem);
            $.ajax({
                type: "GET",
                url: "./AylikPuantajListele?donem=" + donem,
                success: function (data) {
                    $("#loader-wrapper").hide();
                    document.getElementById("Tarih").innerHTML = "<strong>" + donem + "</strong> Ayın Kayıtları ";
                    data = JSON.parse(JSON.parse(JSON.stringify(data)));
                    console.log(data);
                    var list = $('#Kayitlar tbody');
                    list.find('tbody tr').remove();
                    list.find('tbody th').remove();
                    list.find('div').remove();
                    var rows;
                    var symbol = "<td style='color:red'><i class='fa fa-close' aria-hidden='true'></i></td>";
                    $.each(data, (i, item) => {
                        rows += "<tr>" +
                                 "<td>" + "#" + "</td>" +
                                 "<td>" + item.PAdSoyad + "</td>";
                        $.each(item.WorkTime, (i, item2) => {
                            //console.log(item.WorkTime);
                            if (item2.PuantajControl == 0) {
                                symbol = "<td style='color:limegreen'><i class='fa fa-check' aria-hidden='true'></i></td>";
                            }
                            else if (item2.PuantajControl == 2) {
                                symbol = "<td><i class='fa fa-moon-o' aria-hidden='true'></i></td>"
                            }
                            else {
                                symbol = "<td style='color:red'><i class='fa fa-close' aria-hidden='true'></i></td>";
                            }
                            rows += symbol;
                        })
                        rows += "</tr>";
                    })
                    $('#Kayitlar tbody').html(rows);
                }

            })

        });

        var tableToExcel = (function () {
            var uri = 'data:application/vnd.ms-excel;base64,'
              , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
              , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
              , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
            return function (table, name) {
                if (!table.nodeType) table = document.getElementById(table)
                var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
                window.location.href = uri + base64(format(template, ctx))
            }
        })()

    </script>

</main>
